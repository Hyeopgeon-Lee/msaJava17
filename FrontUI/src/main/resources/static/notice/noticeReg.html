<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>게시판 글쓰기</title>
    <link rel="stylesheet" href="/css/table.css"/>
    <script type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="/js/jquery.serializeObject.min.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#btnSend").on("click", doSubmit);
            $("#btnList").on("click", () => location.href = "/notice/noticeList.html");
        });

        function doSubmit() {
            const f = document.getElementById("f");

            // 간단 검증
            if (!f.title.value.trim()) {
                alert("제목을 입력하세요.");
                f.title.focus();
                return;
            }
            if (!f.contents.value.trim()) {
                alert("내용을 입력하세요.");
                f.contents.focus();
                return;
            }

            const noticeYn = $('input[name="noticeYn"]:checked').val();
            if (!noticeYn) {
                alert("공지글 여부를 선택하세요.");
                $('input[name="noticeYn"]').first().focus();
                return;
            }

            // 중복 클릭 방지
            $("#btnSend").prop("disabled", true).text("등록 중...");

            $.ajax({
                url: apiUrl("/notice/v1/noticeInsert"),
                method: "POST",
                data: JSON.stringify($("#f").serializeObject())

            }).done((res) => {
                // 공통 응답 포맷: { status, message, data: { result, msg } }
                if (res?.status === 200 && res?.data?.result === 1) {
                    alert(res.data.msg || "등록되었습니다.");
                    location.href = "/notice/noticeList.html";
                    return;
                }
                // 비정상 응답이지만 200인 경우
                alert(res?.data?.msg || "등록에 실패했습니다. 다시 시도해 주세요.");

            }).fail((jqXHR) => {
                alert(extractErrorMessageFromXhr(jqXHR));

            }).always(() => {
                $("#btnSend").prop("disabled", false).text("등록");

            });
        }
    </script>

</head>
<body>
<h2>공지사항 등록하기</h2>
<hr/>
<br/>
<form name="f" id="f">
    <div class="divTable minimalistBlack">
        <div class="divTableBody">
            <div class="divTableRow">
                <div class="divTableCell">제목
                </div>
                <div class="divTableCell">
                    <input type="text" name="title" maxlength="100" style="width: 95%"/>
                </div>
            </div>
            <div class="divTableRow">
                <div class="divTableCell">공지글 여부
                </div>
                <div class="divTableCell">
                    예<input type="radio" name="noticeYn" value="Y"/>
                    아니오<input type="radio" name="noticeYn" value="N"/>
                </div>
            </div>
            <div class="divTableRow">
                <div class="divTableCell">내용</div>
                <div class="divTableCell">
                    <textarea name="contents" style="width: 95%; height: 400px"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div>
        <button id="btnSend" type="button">등록</button>
        <button type="reset">다시 작성</button>
        <button id="btnList" type="button">목록</button>
    </div>
</form>
</body>
</html>